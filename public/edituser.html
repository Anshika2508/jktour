<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
   <style>/* Global Styles */
    body {
       
        font-family: 'Roboto', sans-serif;
        margin:;
        padding: 0;
        background-color: #121212;
        color: #e0e0e0;
        display: flex;
        flex-direction: column;
       
        
        min-height: 100vh;
    }
    
    .header {
            padding: 20px 50px;
            background-color: #1a2b3c;
            color: #fff;
        }
    
        .logo {
            font-size: 24px;
            color: #f0db4f;
        }
    
        .nav ul {
            list-style: none;
            padding: 0;
        }
    
        .nav ul li {
            display: inline-block;
            margin-right: 20px;
        }
    
        .nav a {
            color: #f0db4f;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }
    
        .nav a:hover {
            background-color: #f0db4f;
            color: #333;
            padding: 8px;
            border-radius: 5px;
        }
    
    
    /* User Info Section */
    .userinfo-section {
        margin: auto;
        padding: 20px;
        width: 80%;
    }
    
    .section-title {
        font-size: 24px;
        color: #ff9800;
        margin-bottom: 20px;
        text-align: center;
    }
    
    .profile-pic img {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        border: 3px solid #ff9800;
        margin-bottom: 15px;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
    
    .bio-section p {
        font-size: 16px;
        color: #b0b0b0;
        text-align: center;
    }
    
    .bio-section button {
        display: block;
        margin: 10px auto;
        background-color: #ff9800;
        padding: 8px 16px;
        border-radius: 5px;
        color: #fff;
        border: none;
        cursor: pointer;
    }
    
    .bio-section button:hover {
        background-color: #e68900;
    }
    
    /* User Info Form */
    .user-info {
        background: #1f1f1f;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.3);
    }
    
    .user-info .row {
        margin-bottom: 15px;
    }
    
    .user-info .col-md-6 {
        margin-bottom: 10px;
    }
    
    .user-info label {
        font-weight: 500;
    }
    
    .form-control {
        background-color: #333;
        border: 1px solid #444;
        padding: 10px;
        width: 100%;
        color: #e0e0e0;
        border-radius: 5px;
        font-size: 14px;
    }
    
    .user-info button {
        background-color: #ff9800;
        border: none;
        padding: 8px 16px;
        color: #fff;
        border-radius: 5px;
        cursor: pointer;
    }
    
    .user-info button:hover {
        background-color: #e68900;
    }
    
    /* Recent Activity Section */
    .recent-activity {
        background-color: #1f1f1f;
        border-radius: 12px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.3);
    }
    
    .recent-activity h3 {
        font-size: 18px;
        color: #ff9800;
    }
    
    .recent-activity ul {
        list-style: none;
        padding: 0;
        margin-top: 10px;
    }
    
    .recent-activity li {
        color: #b0b0b0;
        margin: 8px 0;
    }
    
    /* Footer Styles */
    .footer {
        background: #1f1f1f;
        color: #e0e0e0;
        text-align: center;
        padding: 20px 0;
        border-radius: 8px;
        margin-top: 20px;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.4);
    }
    
    .footer a {
        color: #ff9800;
        text-decoration: none;
        transition: color 0.3s ease;
    }
    
    .footer a:hover {
        color: #fff;
    }
    
    /* Popup Styles */
    .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
    }
    
    .popup-overlay.show {
        display: block;
    }
    
    .popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #fff;
        color: #333;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.4);
        display: none;
        width: 300px;
        text-align: center;
    }
    
    .popup.show {
        display: block;
    }
    
    .popup .error-icon {
        width: 40px;
        height: 40px;
        margin-bottom: 10px;
    }
    
    .popup .message {
        font-size: 16px;
        margin-bottom: 15px;
    }
    
    .popup button {
        background-color: #ff9800;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    
    .popup button:hover {
        background-color: #e68900;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .container {
            width: 95%;
        }
    
        .nav ul {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    
        .nav ul li {
            margin: 10px 0;
        }
    
        .userinfo-section {
            padding: 15px;
        }
    
        .user-info {
            padding: 15px;
        }
    }
    </style>
    
</head>
<body>
     <!-- Overlay for dimming the background -->
     <div id="popup-overlay" class="popup-overlay"></div>

     <!-- Popup -->
     <div id="login-popup" class="popup">
         <!-- SVG Error Icon -->
         <svg class="error-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
             <circle cx="12" cy="12" r="10" stroke="black" stroke-width="2" fill="none"/>
             <line x1="9" y1="9" x2="15" y2="15" stroke="black" stroke-width="2"/>
             <line x1="15" y1="9" x2="9" y2="15" stroke="black" stroke-width="2"/>
         </svg>
         <p class="message">You are not logged in. Please log in first. If you don't have an account, <a href="signup.html">sign up</a>.</p>
         <button id="close-popup" class="btn btn-primary">OK</button>
     </div>
    <header class="header">
        <div class="container">
            <h1 class="logo">Explore J&K</h1>
            <nav class="nav">
                <ul><li><a href="index.html" >Home</a></li>
                    <li><a href="about.html" >About</a></li>
                    <li><a href="places.html" >Places to Visit</a></li>
                    <li><a href="contact.html" >Contact</a></li>
                    <li><a href="signup.html" >Sign up</a></li>
                    <li><a href="feedback.html" >Feedback</a></li>
                    <li><a href="food.html" >Food and culture</a></li>
                </ul>
            </nav>
        </div>
        <div class="nav-item" style="text-align: right; margin-right: 40px;">
            <!-- Wishlist Button -->
             <a class="nav-link" href="userinfo.html"  style="margin-right: 80px ; text-align: right; background-color: #FFE4E1; padding: 8px 15px; border-radius: 5px; text-decoration: none; color: #333; transition: all 0.3s ease; display: inline-block; margin: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);" onmouseover="this.style.backgroundColor='#FFB6C1'" onmouseout="this.style.backgroundColor='#FFE4E1'">User Info</a>
  
        </div>  
    </header>

    <section class="userinfo-section">
        <div class="container">
            <h2 class="section-title">User Profile</h2>

            <!-- Profile Picture -->
            <div class="profile-pic">
                <img id="profile-pic" src="" alt="Profile Picture" class="img-fluid rounded-circle">
            </div>

            <!-- About/Bio Section -->
            <div class="bio-section">
                <p id="bio">Your bio will appear here.</p>
                <button id="edit-bio" class="btn">Edit</button>
            </div>

            <hr>

            <!-- User Info -->
            <div class="user-info">
                <div class="row">
                    <div class="col-md-6">
                        <label>Name:</label>
                        <input type="text" id="name" class="form-control" disabled>
                        <button id="edit-name" class="btn">Edit</button>
                    </div>
                    <div class="col-md-6">
                        <label>Email:</label>
                        <input type="email" id="email" class="form-control" disabled>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label>Password:</label>
                        <input type="password" id="password" class="form-control" disabled>
                    </div>
                    <div class="col-md-6">
                        <label>Favorite Book:</label>
                        <input type="text" id="favorite-book" class="form-control" disabled>
                        <button id="edit-fav-book" class="btn">Edit</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label>Hobbies:</label>
                        <input type="text" id="hobbies" class="form-control" disabled>
                        <button id="edit-hobbies" class="btn">Edit</button>
                    </div>
                    <div class="col-md-6">
                        <label>Favorite Places:</label>
                        <input type="text" id="favorite-places" class="form-control" disabled>
                        <button id="edit-places" class="btn">Edit</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label>Age:</label>
                        <input type="number" id="age" class="form-control" disabled>
                        <button id="edit-age" class="btn">Edit</button>
                    </div>
                    <div class="col-md-6">
                        <label>Gender:</label>
                        <select id="gender" class="form-control" disabled>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                        <button id="edit-gender" class="btn">Edit</button>
                    </div>
                </div>
            </div>

            <hr>


            
        </div>
    </section>

    <footer class="footer">
        <p>Contact us at <a href="mailto:info@explorejk.com" style="color:#f0db4f;">info@explorejk.com</a></p>
        <p>Follow us on:</p>
        <div class="social-links">
            <a href="#" class="social-icon">Facebook</a>
            <a href="#" class="social-icon">Twitter</a>
            <a href="#" class="social-icon">Instagram</a>
        </div>
     
    </footer>
     <!-- Check login status -->
     <script>
       // Check if the user is logged in
const loggedInUser = localStorage.getItem('loggedInUser');
const content = document.querySelector('.main-content1'); // Content to blur

if (!loggedInUser) {
    // Apply blur effect on the content and show the popup
    content.classList.add('blurred');
    const popup = document.getElementById('login-popup');
    const overlay = document.getElementById('popup-overlay');
    popup.classList.add('show');
    overlay.classList.add('show');

    // Redirect to login page after 6 seconds
    setTimeout(() => {
        window.location.href = 'signin.html'; // Redirect to sign-in page
    }, 6000); // 6 seconds delay
}

// Close the popup and redirect immediately when the button is clicked
document.getElementById('close-popup').addEventListener('click', function() {
    const popup = document.getElementById('login-popup');
    const overlay = document.getElementById('popup-overlay');
    popup.classList.remove('show');
    overlay.classList.remove('show');
    content.classList.remove('blurred'); // Remove blur effect

    // Redirect to the login page immediately after closing the popup
    window.location.href = 'signin.html'; // Redirect to sign-in page
});

// Fetch user data from localStorage
const userData = JSON.parse(localStorage.getItem('userData')) || {};

// Capitalize first letter for slug
function capitalizeFirstLetter(str) {
    return str
        .split('-') // Split by hyphens for slug format
        .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()) // Capitalize each word
        .join(' '); // Join back with spaces
}

// Display user data
document.getElementById('profile-pic').src = userData.profilePicUrl || 'images/default-profile.jpg';
document.getElementById('bio').textContent = userData.bio || 'This is your bio. Click Edit to update it.';
document.getElementById('name').value = userData.name || '';
document.getElementById('email').value = userData.email || '';
document.getElementById('favorite-book').value = capitalizeFirstLetter(userData.favoriteBook) || '';
document.getElementById('hobbies').value = userData.hobbies || '';
document.getElementById('favorite-places').value = userData.favoritePlaces || '';
document.getElementById('age').value = userData.age || '';
document.getElementById('gender').value = userData.gender || 'male';

// Edit button functionality
document.getElementById('edit-name').addEventListener('click', () => toggleEdit('name'));
document.getElementById('edit-bio').addEventListener('click', () => toggleEdit('bio'));
document.getElementById('edit-fav-book').addEventListener('click', () => toggleEdit('favorite-book'));
document.getElementById('edit-hobbies').addEventListener('click', () => toggleEdit('hobbies'));
document.getElementById('edit-places').addEventListener('click', () => toggleEdit('favorite-places'));
document.getElementById('edit-age').addEventListener('click', () => toggleEdit('age'));
document.getElementById('edit-gender').addEventListener('click', () => toggleEdit('gender'));
document.getElementById('edit-profile-pic').addEventListener('change', handleProfilePicChange);

// Function to toggle edit state
function toggleEdit(fieldId) {
    const inputField = document.getElementById(fieldId);
    const button = document.getElementById(`edit-${fieldId}`);
    const isEditable = inputField.disabled || inputField.contentEditable === 'false';

    if (fieldId === 'bio') {
        // Handle bio separately since it uses contentEditable
        if (isEditable) {
            inputField.contentEditable = 'true';
            button.textContent = 'Save';
        } else {
            inputField.contentEditable = 'false';
            button.textContent = 'Edit';
            saveChanges(fieldId);
        }
    } else {
        // Handle other fields
        inputField.disabled = !isEditable;
        button.textContent = isEditable ? 'Save' : 'Edit';

        if (!isEditable) {
            saveChanges(fieldId);
        }
    }
}

// Save changes to localStorage
async function saveChanges(fieldId) {
    const inputField = document.getElementById(fieldId);
    if (inputField && inputField.value !== undefined) {
        // Update user data in localStorage
        userData[fieldId] = fieldId === 'bio' ? inputField.textContent : inputField.value;
        localStorage.setItem('userData', JSON.stringify(userData));

        // Send updated data to the backend
        try {
            const response = await sendUpdatedDataToServer(userData);
            if (response.success) {
                logActivity(fieldId); // Log activity if update is successful
            } else {
                showToast('Failed to update data on the server. Please try again later.', 'error');
            }
        } catch (error) {
            showToast('An error occurred while updating data. Please try again later.', 'error');
        }
    }
}async function sendUpdatedDataToServer(userData) {
    try {
        const response = await fetch('http://localhost:4000/updateUserData', { // Replace with actual backend API URL
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({userData}),
        });

        const data = await response.json();
        return data; // Return the response from the server
    } catch (error) {
        console.error('Error updating user data on server:', error);
        throw error;
    }
}

// Log activity (user updates fields)
function logActivity(fieldId) {
    const activityList = document.getElementById('activity-list');
    const date = new Date().toLocaleDateString();
    const activityItem = document.createElement('li');
    activityItem.textContent = `Updated ${fieldId.replace('-', ' ')} - ${date}`;
    activityList.appendChild(activityItem);
}

// Handle profile picture change
function handleProfilePicChange(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('profile-pic').src = e.target.result;
            userData.profilePicUrl = e.target.result;
            localStorage.setItem('userData', JSON.stringify(userData));
        };
        reader.readAsDataURL(file);
    }
}

    </script>
    
</body>
</html>
